---
lab:
    title: '9: Azure Site Recovery를 사용한 Hyper-V VM 보호'
    module: '모듈 9: Azure에서 워크로드 관리'
---

# 랩: Azure Site Recovery를 사용하여 Hyper-V VM 보호
# 학생 랩 매뉴얼

## 랩 시나리오

Adatum Corporation은 수년에 걸쳐 온-프레미스 워크로드에 대해 여러 가지 고가용성 조항을 구현했지만, 재해 복구 기능은 여전히 비즈니스에서 요구하는 RPO(복구 지점 목표) 및 RTO(복구 시간 목표)를 해결하기에는 충분하지 않습니다. 기존 보조 온-프레미스 사이트 유지 관리는 광범위한 노력이 필요하며 상당한 비용이 발생합니다. 장애 조치(failover) 및 장애 복구(failback) 절차는 대부분 수동이며 문서화되지 않습니다. 

이러한 단점을 해결하기 위해 Adatum 엔터프라이즈 아키텍처 팀은 Azure를 보조 사이트의 호스트 역할로 수행하면서, Azure Site Recovery 기능을 탐색하기로 결정하였습니다 Azure Site Recovery는 기본 사이트에서 보조 사이트로 물리적 및 가상 머신에서 실행되는 워크로드를 자동으로 지속적으로 복제합니다. Site Recovery는 애플리케이션 데이터를 가로채지 않고 스토리지 기반 복제 메커니즘을 사용합니다. Azure를 보조 사이트로 사용하면 데이터가 Azure Storage에 저장되며 복원력이 내장되고 비용이 절감됩니다. 대상 Azure VM은 복제된 데이터를 사용하여 장애 조치 후 하이드레이션됩니다. Site Recovery는 VMware VM에 대한 지속적인 복제와 Hyper-V VM에 대한 복제 빈도가 30 초에 불과하기 때문에 RTO(복구 시간 목표) 및 복구 지점 목표가 최소화됩니다. 또한 Azure Site Recovery는 장애 조치 및 장애 복구 프로세스의 오케스트레이션을 처리하므로 이를 통해 대규모로 자동화할 수 있습니다. 권장 방식은 Azure Migrate를 대신 사용하는 것이지만, Azure Site Recovery를 사용하여 Azure로 마이그레이션 할 수도 있습니다.

Adatum 엔터프라이즈 아키텍처 팀은 Azure VM에 대한 온-프레미스 Hyper-V 가상 머신을 보호하기 위해 Azure Site Recovery의 사용을 평가하려고 합니다.

## 목적
  
이 랩을 완료하면 다음과 같은 작업을 수행할 수 있습니다.

-  Azure Site Recovery 구성

-  테스트 장애 조치(failover) 수행

-  계획된 장애 조치(failover) 수행

-  계획되지 않은 장애 조치(failover) 수행


## 랩 환경

Windows 서버 관리자 자격 증명

-  사용자 이름: **Student**

-  암호: **Pa55w.rd1234**

예상 시간: 120분


## Lab Files

-  \\\\AZ303\\AllFiles\\Labs\\07\\azuredeploy30307suba.json


### 연습 0: 랩 환경 준비

이 연습의 주요 작업은 다음과 같습니다.

1. Azure Resource Manager 빠른 시작 템플릿을 사용하여 Azure VM 배포.

1. Azure VM에서 중첩된 가상화 구성


#### 작업 1: Azure Resource Manager 빠른 시작 템플릿을 사용하여 Azure VM 배포.

1. 랩 컴퓨터에서 웹 브라우저를 시작하여 [Azure Portal](https://portal.azure.com)로 이동하고, 이 랩에서 사용할 구독에서 소유자 역할을 가진 사용자 계정의 자격 증명을 제공하여 로그인합니다.

1. Azure Portal에서 검색 텍스트 상자의 오른쪽에 있는 도구 모음 아이콘을 직접 선택하여 **Cloud Shell** 창을 엽니다.

1. **Bash** 또는 **PowerShell**을 선택하라는 메시지가 표시되면 **PowerShell**을 선택합니다. 

    >**참고**: **Cloud Shell**을 처음 시작하고 **탑재된 스토리지가 없음** 메시지를 받으면, 이 랩에서 사용하는 구독을 선택하고 **스토리지 만들기**를 선택합니다. 

1. Cloud Shell 창의 도구 모음에서 **파일 업로드/다운로드** 아이콘을 선택한 다음, 드롭다운 메뉴에서 **업로드**를 선택하여 **\\\\AZ303\\AllFiles\Labs\\07\\azuredeploy30307suba.json** 파일을 Cloud Shell 홈 디렉터리에 업로드합니다.

1. Cloud Shell 창에서 다음을 실행하여 리소스 그룹을 만듭니다(`<Azure region>` 자리 표시자를 구독에 Azure VM을 배포할 수 있고 랩 컴퓨터 위치에 가장 가까운 Azure 지역의 이름으로 대체).

   ```powershell
   $location = '<Azure region>'
   New-AzSubscriptionDeployment `
     -Location $location `
     -Name az30307subaDeployment `
     -TemplateFile $HOME/azuredeploy30307suba.json `
     -rgLocation $location `
     -rgName 'az30307a-labRG'
   ```

      > **참고**: Azure VM을 프로비전할 수 있는 Azure 지역을 확인하려면 [**https://azure.microsoft.com/ko-kr/regions/offers/**](https://azure.microsoft.com/ko-kr/regions/offers/)을 참조하세요.

1. Azure Portal에서 **Cloud Shell** 창을 닫습니다.

1. 랩 컴퓨터에서 다른 브라우저 탭을 열고 [301-nested-vms-in-virtual-network Azure 빠른 시작 템플릿](https://github.com/Azure/azure-quickstart-templates/tree/master/301-nested-vms-in-virtual-network)으로 이동한 다음 **Azure에 배포**를 선택합니다. 이렇게 하면 브라우저를 자동으로 Azure Portal에 있는 **중첩된 VM이 있는 Hyper-V 호스트 가상 머신** 블레이드로 리디렉션합니다.

1. Azure Portal의 **중첩된 VM이 있는 Hyper-V 호스트 가상 머신** 블레이드에서 다음 설정을 지정합니다(다른 설정을 기본값으로 남겨둡니다).

    | 설정 | 값 | 
    | --- | --- |
    | 구독 | 이 랩에서 사용 중인 Azure 구독의 이름 |
    | 리소스 그룹 | **az30307a-LabRG** |
    | 호스트 공용 IP 주소 이름 | **az30307a-hv-vm-pip** |
    | Virtual Network 이름 | **az30307a-hv-vnet** |
    | 호스트 네트워크 인터페이스1이름 | **az30307a-hv-vm-nic1** |
    | 호스트 네트워크 인터페이스2이름 | **az30307a-hv-vm-nic2** |
    | 호스트 가상 머신 이름 | **az30307a-hv-vm** |
    | 호스트 관리자 사용자 이름 | **Student** |
    | 호스트 관리자 암호 | **Pa55w.rd1234** |

1. **중첩된 VM이 포함된 Hyper-V 호스트 가상 머신** 블레이드에서 **검토 + 만들기**를 선택한 다음, **만들기**를 선택합니다.

    > **참고**: 배포가 완료될 때까지 기다립니다. 배포에는 약 10분이 소요될 수 있습니다.

#### 작업 2: Azure VM에서 중첩된 가상화 구성

1. Azure Portal에서 **가상 머신**을 검색 및 선택하고 **가상 머신** 블레이드에서 **az30307a-hv-vm**을 선택합니다.

1. **az30307a-hv-vm** 블레이드에서 **네트워킹**을 선택합니다. 

1. **az30307a-hv-vm**에서 | **네트워킹** 블레이드에서 **az30307a-hv-vm-nic1**을 선택한 다음 **인바운드 포트 규칙 추가**를 선택합니다.

    >**참고**: 공용 IP 주소가 할당된 **az30307a-hv-vm-nic1**의 설정을 수정해야 합니다.

1. **인바운드 보안 규칙 추가** 블레이드에서 다음 설정을 지정하고(다른 설정은 기본값으로 남겨둡니다) **추가**를 선택합니다.

    | 설정 | 값 | 
    | --- | --- |
    | 대상 포트 범위 | **3389** |
    | 프로토콜 | **모두** |
    | 이름 | **AllowRDPInBound** |

1. **az30307a-hv-vm** 블레이드에서 **개요**를 선택합니다. 

1. **az30307a-hv-vm** 블레이드의 드롭다운 메뉴에서 **연결**을 선택하고 **RDP**를 선택한 다음 **RDP 파일 다운로드**를 클릭합니다.

1. 메시지가 표시되면 다음 자격 증명으로 로그인합니다.

-  사용자 이름: **Student**

-  암호: **Pa55w.rd1234**

1. **az30307a-hv-vm**에 대한 원격 데스크톱 세션의 서버 관리자 창에서 **로컬 서버**를 클릭하고 **IE 강화된 보안 구성** 레이블 옆에 있는 **켜기** 링크를 클릭한 뒤 **IE 강화된 보안 구성** 대화 상자에서 둘 다 **끄기** 옵션을 선택합니다.

1. **az30307a-hv-vm**에 대한 원격 데스크톱 세션에서 Internet Explorer를 시작하고 [Windows 서버 평가](https://www.microsoft.com/ko-kr/evalcenter/evaluate-windows-server-2019)를 찾은 뒤 Windows 서버 2019 **VHD** 파일을 **F:\VHDs** 폴더(이 폴더를 먼저 만들어야 함)에 다운로드합니다. 

1. **az30307a-hv-vm**에 대한 원격 데스크톱 세션 내에서 **Hyper-V 관리자**를 시작합니다. 

1. **Hyper-V 관리자** 콘솔에서 **az30307a-hv-vm** 노드를 선택하고 **새로 만들기** 선택한 후 계단식 메뉴에서 **가상 머신**을 선택합니다. 이렇게 하면 **새 가상 머신 마법사**가 시작됩니다. 

1. **새 가상 머신 마법사**의 **시작하기 전** 페이지에서 **다음 >** 을 클릭합니다.

1. **새 가상 머신 마법사**의 **이름 및 위치 지정** 페이지에서 다음 설정을 지정하고 **다음 >** 을 선택합니다.

    | 설정 | 값 | 
    | --- | --- |
    | 이름 | **az30307a-vm1** | 
    | 가상 머신을 다른 위치에 저장 | 선택 | 
    | 위치 | **F:\VMs** |

    >**참고**: **F:\VMs** 폴더를 만들어야 합니다.

1. **새 가상 머신 마법사**의 **생성 지정** 페이지에서 **생성 1** 옵션을 선택하고 **다음 >** 을 선택합니다.

1. **새 가상 머신 마법사**의 **메모리 할당** 페이지에서 **시작 메모리**를 **2048**로 설정하고 **다음 >** 을 선택합니다.

1. **새 가상 머신 마법사**의 **네트워킹 구성** 페이지에 있는 **연결** 드롭다운 리스트에서 **NestedSwitch**를 선택하고 **다음 >** 을 선택합니다.

1. **새 가상 머신 마법사**의 **가상 하드 디스크 연결** 페이지에서 **기존 가상 하드 디스크 사용** 옵션을 선택하여 다운로드한 VHD 파일을 **F:\VHD** 폴더로 위치를 설정하고 **다음 >** 을 선택합니다.

1. **새 가상 머신 마법사**의 **요약** 페이지에서 **완료**를 선택합니다.

1. **Hyper-V 관리자** 콘솔에서 새로 만든 가상 머신을 선택하고 **시작**을 선택합니다. 

1. **Hyper-V 관리자** 콘솔에서 가상 머신이 실행 중인지 확인하고 **연결**을 선택합니다. 

1. **az30307a-vm1**에 대한 가상 머신 연결 창의 **Hi there** 페이지에서 **다음**을 선택합니다. 

1. **az30307a-vm1**에 대한 가상 머신 연결 창의 **사용 조건** 페이지에서 **수락**을 선택합니다. 

1. **az30307a-vm1**에 대한 가상 머신 연결 창의 **사용자 지정 설정** 페이지에서 기본 제공 관리자 계정의 암호를 **Pa55w.rd1234**로 설정하고 **마침**을 선택합니다. 

1. **az30307a-vm1**에 대한 가상 머신 연결 창에서 새로 설정된 암호를 사용하여 로그인합니다.

1. **az30307a-vm1**에 대한 가상 머신 연결 창에서 Windows PowerShell을 시작하고 **관리자**에서 다음을 수행합니다.**Windows PowerShell** 창은 다음을 실행하여 컴퓨터 이름을 설정합니다. 

   ```powershell
   Rename-Computer -NewName 'az30307a-vm1' -Restart
   ```

### 연습 1: Azure Site Recovery 자격 증명 모음을 만들고 구성
  
이 연습의 주요 작업은 다음과 같습니다.

1. Azure Site Recovery 자격 증명 모음 만들기

1. Azure Site Recovery 자격 증명 모음 구성


#### 작업 1: Azure Site Recovery 자격 증명 모음 만들기

1. **az30307a-hv-vm**에 대한 원격 데스크톱 세션에서 Internet Explorer를 시작하고 [Azure Portal](https://portal.azure.com)로 이동하며 사용자 계정의 자격 증명을 이 랩에서 사용할 구독에서 소유자 역할로 제공하여 로그인합니다.

1. Azure Portal에서 **Recovery Services 자격 증명 모음**을 검색 및 선택하고 **Recovery Services 자격 증명 모음** 블레이드에서 **+ 추가**를 선택합니다.

1. **Recovery Services 자격 증명 모음 만들기** 블레이드의 **기본** 탭에서 다음 설정을 지정하고(다른 설정은 기본값으로 남겨둔 채) **검토 + 만들기**를 선택합니다.

    | 설정 | 값 | 
    | --- | --- |
    | 구독 | 이 랩에서 사용 중인 Azure 구독의 이름 |
    | 리소스 그룹 | 새 리소스 그룹 **az30307b-labRG**의 이름 |
    | 자격 증명 모음 이름 | **az30307b-rsvault** |
    | 위치 | 이 랩의 앞 부분에서 가상 머신을 배포한 지역과 다른 Azure 지역의 이름 |

1. **Recovery Services 자격 증명 모음 만들기** 블레이드의 **검토 + 만들기** 탭에서 **만들기**를 선택합니다.

    >**참고**: 기본적으로 스토리지 복제 형식의 기본 구성은 GRS(지역 중복)로 설정되고 일시 삭제가 사용됩니다. 랩에서 이러한 설정을 변경하여 프로비전 해제를 단순화하지만 프로덕션 환경에서는 이 설정을 사용해야 합니다.


#### 작업 2: Azure Site Recovery 자격 증명 모음 구성

1. Azure Portal에서 **Recovery Services 자격 증명 모음**을 검색 및 선택하고 **Recovery Services 자격 증명 모음** 블레이드에서 **az30307b-rsvault**를 선택합니다.

1. **az30307b-rsvault** 블레이드에서 **속성** 선택합니다. 

1. **az30307b-rsvault** 에서 **| 속성** 블레이드의 **백업 구성** 레이블 아래에서 **업데이트** 링크를 선택합니다.

1. **백업 구성** 블레이드에서 **스토리지 복제 형식**을 **로컬 중복**으로 설정하고 **저장**을 선택하고 **백업 구성**블레이드를 닫습니다.

    >**참고**: 항목 보호를 시작하면 스토리지 복제 유형을 변경할 수 없습니다.

1. **az30307b-rsvault** 에서 **| 속성** 블레이드의 **보안 설정** 레이블 아래에서 **업데이트** 링크를 선택합니다.

1. **보안 설정** 블레이드에서 **일시 삭제**를 **사용 중지**로 설정하고 **저장**를 선택한 다음 **보안 설정** 블레이드를 닫습니다.


### 연습 2: Azure Site Recovery 자격 증명 모음을 사용하여 Hyper-V 보호 구현
  
이 연습의 주요 작업은 다음과 같습니다.

1. 대상 Azure 환경 구현

1. Hyper-V 가상 머신 보호 구현

1. Hyper-V 가상 머신의 장애 조치 수행

1. 랩에 배포된 Azure 리소스 제거


#### 작업 1: 대상 Azure 환경 구현

1. Azure Portal에서 **가상 네트워크**를 검색 및 선택하고 **가상 네트워크** 블레이드에서 **+ 추가**를 선택합니다.

1. **가상 네트워크 만들기** 블레이드의 **기본** 탭에서 다음 설정을 지정하고(나머지는 기본값을 그대로 유지) **다음:** 을 선택합니다. **IP 주소**:

    | 설정 | 값 |
    | --- | --- |
    | 구독 | 이 랩에서 사용 중인 Azure 구독의 이름 |
    | 리소스 그룹 | 새 리소스 그룹 **az30307c-labRG**의 이름 |
    | 이름 | **az30307c-vnet** |
    | 지역 | 이 랩의 이전 연습에서 Recovery Services 자격 증명 모음을 배포한 Azure 지역의 이름 |

1. **가상 네트워크 만들기** 블레이드의 **IP 주소** 탭에서 **IPv4 주소 공간** 입력란에 **10.7.0.0/16** 을 입력하고 **+ 서브넷 추가**를 선택합니다.

1. **서브넷 추가** 블레이드에서 다음 설정(다른 설정은 기본값을 그대로 사용)을 지정하고 **추가**를 선택합니다.

    | 설정 | 값 |
    | --- | --- |
    | 서브넷 이름 | **subnet0** |
    | 서브넷 주소 범위 | **10.7.0.0/24** |

1. **가상 네트워크 만들기** 블레이드의 **IP 주소** 탭에 돌아와서 **검토 + 만들기**를 선택합니다.

1. **가상 네트워크 만들기** 블레이드의 **검토 + 만들기** 탭에서 **만들기**를 선택합니다.

1. Azure Portal에서 **가상 네트워크**를 검색 및 선택하고 **가상 네트워크** 블레이드에서 **+ 추가**를 선택합니다.

1. **가상 네트워크 만들기** 블레이드의 **기본** 탭에서 다음 설정을 지정하고(나머지는 기본값을 그대로 유지) **다음:** 을 선택합니다. **IP 주소**:

    | 설정 | 값 |
    | --- | --- |
    | 구독 | 이 랩에서 사용 중인 Azure 구독의 이름 |
    | 리소스 그룹 | **az30307c-LabRG** |
    | 이름 | **az30307c-test-vnet** |
    | 지역 | 이 랩의 이전 연습에서 Recovery Services 자격 증명 모음을 배포한 Azure 지역의 이름 |

1. **가상 네트워크 만들기** 블레이드의 **IP 주소** 탭에서 **IPv4 주소 공간** 입력란에 **10.7.0.0/16**을 입력하고 **+ 서브넷 추가**를 선택합니다.

1. **서브넷 추가** 블레이드에서 다음 설정(다른 설정은 기본값을 그대로 사용)을 지정하고 **추가**를 선택합니다.

    | 설정 | 값 |
    | --- | --- |
    | 서브넷 이름 | **subnet0** |
    | 서브넷 주소 범위 | **10.7.0.0/24** |

1. **가상 네트워크 만들기** 블레이드의 **IP 주소** 탭에 돌아와서 **검토 + 만들기**를 선택합니다.

1. **가상 네트워크 만들기** 블레이드의 **검토 + 만들기** 탭에서 **만들기**를 선택합니다.

1. Azure Portal에서 **스토리지 계정**을 검색 및 선택하고 **스토리지 계정** 블레이드에서 **+ 추가**를 선택합니다.

1. **스토리지 계정 만들기** 블레이드의 **기본** 탭에서 다음 설정을 지정합니다(나머지는 기본값으로 둡니다).

    | 설정 | 값 | 
    | --- | --- |
    | 구독 | 이 랩에서 사용 중인 Azure 구독의 이름 |
    | 리소스 그룹 | **az30307c-LabRG** |
    | 저장소 계정 이름 | 문자와 숫자로 구성된 3~24자 사이의 전역적으로 고유한 이름 |
    | 위치 | 본 작업의 앞부분에서 가상 네트워크를 만든 곳인 Azure 지역의 이름 |
    | 성능 | **표준** |
    | 계정 종류 | **StorageV2(범용 v2)** |
    | 복제 | **로컬 중복 스토리지 (LRS)** |

1. **스토리지 계정 만들기** 블레이드의 **기본** 탭에서 **검토 + 만들기**를 선택합니다.

1. **스토리지 계정 만들기** 블레이드의 **검토 + 만들기** 탭에서 **만들기**를 선택합니다.


#### 작업 2: Hyper-V 가상 머신 보호 구현

1. Azure Portal에서 **시작** 섹션의 **az30307b-rsvault** 블레이드에서 **az30307a-hv-vm**에 대한 원격 데스크톱 섹션내의 **Site Recovery** 를 선택합니다.

1. **az30307b-rsvault \| Site Recovery** 블레이드의 **Hyper-V 머신에서 Azure로** 섹션에서 **1. 인프라 준비**를 선택합니다. 

1. **인프라 준비** 블레이드 아래 **배포 계획** 탭의 **배포 계획을 완료하셨나요?** 드롭다운 목록에서 **예, 완료했습니다**를 선택하고 **다음**을 선택합니다.

1. **인프라 준비** 블레이드의 **원본 설정** 탭에서 **System Center VMM을 사용하여 Hyper-V 호스트를 관리하나요** 레이블 옆에 위치한 **아니요** 옵션을 선택합니다.

1. **인프라 준비** 블레이드의 **원본 설정** 탭에서 **Hyper-V 사이트 추가** 링크를 선택하고 **Hyper-V 사이트 만들기** 블레이드의 **이름** 텍스트 상자에 **az30307b Hyper-V 사이트**를 입력합니다. 그리고 **확인**을 선택합니다.

1. **인프라 준비** 블레이드의 **원본 설정** 탭에서 **Hyper-V 서버 추가** 링크를 선택합니다. 

1. **서버 추가** 블레이드의 온-프레미스 Hyper-V 호스트 추가 절차 3단계에서 **다운로드** 링크를 선택하여 Microsoft Azure Site Recovery 공급자를 다운로드합니다.

1. 메시지가 표시되면 브라우저 창에서 **실행**을 선택하여 **AzureSiteRecoveryProvider.exe**를 시작합니다. 이렇게 하면 **Azure Site Recovery 공급자 설정(Hyper-V 서버)** 마법사가 시작됩니다.

1. **Microsoft 업데이트** 페이지에서 **끄기**를 선택한 후 **다음**을 선택합니다.

1. **공급자 설치** 페이지에서 **설치**를 클릭합니다.

1. Azure Portal로 전환하고 **서버 추가** 블레이드에서 온-프레미스 Hyper-V 호스트를 등록하는 절차의 4단계에서 **다운로드** 버튼을 선택하여 자격 증명 모음 등록 키를 다운로드합니다. 메시지가 표시되면 **저장**을 선택하여 **다운로드** 폴더에 자격 증명 모음 자격 증명 파일을 저장합니다.

1. **공급자 설치** 마법사 창으로 전환하고 **등록**을 선택합니다. 이렇게 하면 **Microsoft Azure Site Recovery 등록 마법사**가 시작됩니다.

1. **Microsoft Azure Site Recovery 등록 마법사**의 **자격 증명 모음 설정** 페이지에서 **찾아보기**를 선택합니다. **열기** 창에서 **다운로드** 폴더로 이동하여 자격 증명 모음 자격 증명 파일을 선택하고 **열기**를 선택합니다.

1. **Microsoft Azure Site Recovery 등록 마법사**의 **자격 증명 모음 설정** 페이지로 돌아가서 **다음**을 선택합니다.

1. **Microsoft Azure Site Recovery 등록 마법사**의 **프록시 설정** 페이지에서 기본 설정을 수락하고 **다음**을 선택합니다.

1. **Microsoft Azure Site Recovery 등록 마법사**의 **등록** 페이지에서**완료**를 선택합니다.

1. Azure Portal을 표시하는 Internet Explorer 창으로 다시 전환하고 페이지를 새로 고칩니다. 메시지가 표시되면 **페이지에서 나가기**를 선택합니다.

1. **az30307b-rsvault** 로 돌아가기 **| Site Recovery** 블레이드의 **Hyper-V 머신에서 Azure로** 섹션에서 **1. 인프라 준비**를 선택합니다. 

1. **인프라 준비** 블레이드 아래 **배포 계획** 탭의 **배포 계획을 완료하셨나요?** 드롭다운 목록에서 **예, 완료했습니다**을 선택하고 **다음**을 선택합니다.

1. **인프라 준비** 블레이드의 **원본 설정** 탭에서 **System Center VMM을 사용하여 Hyper-V 호스트를 관리하나요** 레이블 옆에 위치한 **아니요** 옵션을 선택합니다.

1. **Hyper-V 사이트** 및 **Hyper-V 서버** 설정이 올바르게 설정되어 있는지 확인하고 **다음**을 선택합니다. 

1. **인프라 준비** 블레이드의 **대상 설정** 탭에서 기본 설정을 수락하고 **다음**을 선택합니다.

1. **인프라 준비** 블레이드의 **복제 정책** 탭에서 **새 정책 만들기 및 연결**을 선택합니다. 

1. **정책 만들기 및 연결** 블레이드에서 다음 설정을 지정하고(다른 설정은 기본값으로 유지) **확인**을 선택합니다.

    | 설정 | 값 |
    | --- | --- |
    | 이름 | **az30307b 복제 정책** |
    | 복사 빈도 | **30초** |

1. **인프라 준비** 블레이드의 **복제 정책** 탭으로 돌아가서 사이트가 정책과 연결될 때까지 기다렸다가 **다음**을 선택합니다.

1. **인프라 준비** 블레이드의 **검토** 탭에서 **준비**를 선택합니다.

1. **az30307b-rsvault \| Site Recovery** 블레이드의 **Hyper-V 머신에서 Azure로** 섹션에서 **2. 복제 사용**을 선택합니다. 

1. **복제 사용** 블레이드 아래 **원본 환경** 탭의 **원본 위치** 드롭다운 목록에서 **az30307b Hyper-V 사이트**를 선택하고 **다음**을 선택합니다.

1. **복제 사용** 블레이드의 **대상 환경** 탭에서 다음 설정을 지정하고(다른 설정은 기본값으로 유지) **다음**을 선택합니다.

    | 설정 | 값 |
    | --- | --- |
    | 구독 | 이 랩에서 사용 중인 Azure 구독의 이름 |
    | 장애 조치(failover) 후 리소스 그룹 | **az30307c-LabRG** |
    | 장애 조치(failover) 후 배포 모델 | **Resource Manager** |
    | 스토리지 계정 | 이 연습의 첫 번째 작업에서 만든 스토리지 계정의 이름 |
    | Azure 네트워크 | 선택한 컴퓨터에 대해 지금 구성 |
    | 장애 조치(failover) 후 Azure 네트워크 | **az30307c-dr-vnet** |
    | 서브넷 | **subnet0 (10.7.0.0/24)** |

1. **복제 사용** 블레이드의 **가상 머신 선택** 탭에서 **az30307a-vm1** 체크박스를 선택하고 **다음**을 선택합니다.

1. **복제 사용** 블레이드 아래 **복제 설정** 탭의 **기본** 행 및 **OS 유형** 열에서 드롭다운 목록의 **Windows**를 선택하고 **다음**을 선택합니다.

1. **복제 사용** 블레이드의 **복제 정책** 탭에서 기본 설정을 수락하고 **다음**을 선택합니다.

1. **복제 사용** 블레이드의 **검토** 탭에서 **복제 사용**을 선택합니다.

#### 작업 3: Azure VM 복제 설정 검토

1. Azure Portal에서 **az30307b-rsvault \| Site Recovery** 블레이드로 돌아가 세로 메뉴에서 **복제된 항목**을 선택합니다. 

1. **az30307b-rsvault \| 복제된 항목** 블레이드에서 **az30307a-vm1** 가상 머신을 표시하는 항목이 있는지 확인하고, **복제 상태**가 **정상**으로 되어있는지 여부를 확인합니다. 그리고 **상태**가 **보호 사용**으로 되어있는지, 아니면 현재 동기화 진행률을 표시하는지 확인합니다.

   > **참고**: **az30307a-vm1** 항목이 **az30307b-rsvault \| 복제된 항목** 블레이드에 표시되려면 몇 분 기다려야 할 수 있습니다..

1. **az30307b-rsvault \| 복제된 항목** 블레이드에서 **az30307a-vm1** 항목을 선택합니다.

1. **az30307a-vm1** 복제된 항목 블레이드에서 **상태**, **장애 조치(Failover) 준비**, **최신 복구 지점** 및 **인프라 보기** 섹션을 검토합니다. **계획된 장애 조치(Failover)**, **장애 조치(Failover)** 및**장애 조치(Failover) 테스트** 도구 모음 아이콘을 기록합니다.

   > **참고**: 상태가 **보호됨**으로 변경될 때까지 기다립니다. 이 경우 15분이 더 걸릴 수 있습니다. 상태를 업데이트하려면 브라우저 페이지를 새로 고쳐야 합니다.

1. **az30307a-vm1** 복제된 항목 블레이드에서 **최신 복구 지점**을 선택하고 **최신 충돌 일치** 및 **최신 앱 일치** 복구 지점을 검토합니다. 

#### 작업 4: Hyper-V 가상 머신의 장애 조치 수행

1. **az30307a-vm0**에 대한 원격 데스크톱 세션 내 Azure Portal을 표시하는 브라우저 창의 **az30307a-vm1** 복제된 항목 블레이드에서 **테스트 장애 조치(failover)** 를 선택합니다. 

1. **테스트 장애 조치(failover)** 블레이드에서 다음 설정을 지정하고(나머지는 기본값을 그대로 유지) **확인**을 선택합니다.

    | 설정 | 값 |
    | --- | --- |
    | 복구 지점 선택 | 기본 옵션 | 
    | Azure 가상 네트워크 | **az30307c-test-vnet** | 


1. Azure Portal에서 **az30307b-rsvault** 블레이드로 다시 이동하여 **사이트 복구 작업**을 선택합니다. **테스트 장애 조치(failover)** 작업의 상태가 **성공**으로 표시될 때까지 기다립니다.

1. Azure Portal에서 **가상 머신**을 검색 및 선택하고 **가상 머신** 블레이드에서 새로 프로비전된 가상 머신 **az30307a-vm1-test**를 나타내는 항목을 기록합니다.

1. Azure Portal에서 **az30307a-vm1** 복제된 항목 블레이드로 다시 이동하여 **테스트 장애 조치(failover) 정리** 를 선택합니다.

1. **테스트 장애 조치(failover) 정리** 블레이드에서 **테스트 완료** 확인란을 선택합니다.**테스트 장애 조치(failover) 가상 머신을 삭제** 하고 **확인**을 선택합니다.

1. 테스트 장애 조치(failover) 정리 작업이 완료되면 **az30307a-vm1** 복제된 항목 블레이드를 표시하는 브라우저 페이지를 새로 고침하고 계획 및 계획되지 않은 장애 조치(failover)를 수행할 수 있는 옵션이 있는지 확인합니다.

1. **az30307a-vm1** 복제된 항목 블레이드에서 **계획된 장애 조치(failover)** 를 선택합니다. 

1. **계획된 장애 조치(failover)** 블레이드에서는 장애 조치(failover) 방향 설정이 이미 설정되어 있으며 수정할 수 없습니다. 

1. **계획된 장애 조치(failover)** 블레이드를 닫고 **az30307a-vm1** 복제된 항목 블레이드에서 **장애 조치(failover)** 를 선택합니다. 

1. **장애 조치(failover)** 블레이드에서는 잠재적인 데이터 손실을 최소화하기 위해 사용 가능한 옵션을 제공합니다. 

1. **장애 조치(failover)** 블레이드를 닫습니다.


#### 작업 4: 랩에 배포된 Azure 리소스 제거

1. **az30307a-vm0**에 대한 원격 데스크톱 세션 내 Azure Portal을 표시하는 브라우저 창의 Cloud Shell 창 내에서 PowerShell 세션을 시작합니다.

1. Cloud Shell 창에서 다음을 실행하여 이 연습에서 만든 리소스 그룹을 나열합니다.

   ```powershell
   Get-AzResourceGroup -Name 'az30307*'
   ```

    > **참고**: 이 랩에서 만든 리소스 그룹만 출력에 포함되어 있는지 확인합니다. 이 작업에서는 이러한 그룹을 삭제할 것입니다.

1. Cloud Shell 창에서 다음을 실행하여 이 랩에서 만든 리소스 그룹을 삭제합니다.

   ```powershell
   Get-AzResourceGroup -Name 'az30307*' | Remove-AzResourceGroup -Force -AsJob
   ```

1. Cloud Shell 창을 닫습니다.
